}
}
preds <- predict(model, newdata=sub_data %>% select(-Y), type="prob")
preds <- as_tibble(preds)
preds$argmax <- apply(
preds[, c('0', '1')], 1, function(x) names(which.max(x)))
pred_df <- data.frame()
for(idx in 1:length(preds)){
argmax <- preds[idx, "argmax"]$argmax
prob <- preds[idx, argmax][[argmax]]
# if(prob > 0.5){
#  pred <- 1
#} else {
#  pred <- 0
#}
actual <- sub_data[idx, "Y"]$Y
pred_df <- rbind(pred_df, data.frame(
idx=idx,
prob=prob,
pred=argmax,
actual=actual
))
}
head(pred_df)
confusionMatrix(as.factor(pred_df$actual), as.factor(pred_df$pred))
ctrl <- trainControl(method="cv", number=5)
sub_data$Y <- as.factor(sub_data$Y)
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5,
# Y ~ var_19 + var_6 +var_21 + var_1 + var_13 + var_15,
data=sub_data,
method="glm", family="binomial", trControl=ctrl)
print(model)
preds <- predict(model, newdata=sub_data %>% select(-Y), type="prob")
preds <- as_tibble(preds)
preds$argmax <- apply(
preds[, c('0', '1')], 1, function(x) names(which.max(x)))
pred_df <- data.frame()
for(idx in 1:length(preds)){
argmax <- preds[idx, "argmax"]$argmax
prob <- preds[idx, argmax][[argmax]]
# if(prob > 0.5){
#  pred <- 1
#} else {
#  pred <- 0
#}
actual <- sub_data[idx, "Y"]$Y
pred_df <- rbind(pred_df, data.frame(
idx=idx,
prob=prob,
pred=argmax,
actual=actual
))
}
head(pred_df)
confusionMatrix(as.factor(pred_df$actual), as.factor(pred_df$pred))
roc(pred_df$actual ~ pred_df$prob, plot = TRUE, print.auc = TRUE)
preds
# using raw values
preds <- predict(model, newdata=sub_data %>% select(-Y), type="raw")
preds
pred_df <- data.frame()
for(idx in 1:length(preds)){
# argmax <- preds[idx, "argmax"]$argmax
# prob <- preds[idx, argmax][[argmax]]
pred <- preds[idx]
actual <- sub_data[idx, "Y"]$Y
pred_df <- rbind(pred_df, data.frame(
idx=idx,
prob=prob,
pred=pred,
actual=actual
))
}
head(pred_df)
pred_df <- data.frame()
for(idx in 1:length(preds)){
# argmax <- preds[idx, "argmax"]$argmax
# prob <- preds[idx, argmax][[argmax]]
pred <- preds[idx]
actual <- sub_data[idx, "Y"]$Y
pred_df <- rbind(pred_df, data.frame(
idx=idx,
# prob=prob,
pred=pred,
actual=actual
))
}
head(pred_df)
confusionMatrix(as.factor(pred_df$actual), as.factor(pred_df$pred))
model$pred$mtry == 2
# ROC Analysis
library(mlbench)
install.packages("mlbench")
# ROC Analysis
library(mlbench)
selected_indices <- model$pred$mtry == 2
plot.roc(model$pred$obs[selectedIndices], model$pred$M[selectedIndices])
selectedIndices <- model$pred$mtry == 2
plot.roc(model$pred$obs[selectedIndices], model$pred$M[selectedIndices])
glm_model <- glm(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5,
data=subset_data,
family=binomial
)
glm_model <- glm(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5,
data=sub_data,
family=binomial
)
summary(glm_model)
varImp(model)
plot(model)
auc_data <- as_tibble(sub_data)
class <- predict(model, auc_data %>% select(-Y))
probs <- predict(model, auc_data %>% select(-Y),'prob')
TEST.scored <- cbind(auc_data,class,probs) %>% mutate(data = "TEST")
head(TEST.scored)
auc_data <- as_tibble(sub_data)
class <- predict(model, auc_data %>% select(-Y))
probs <- predict(model, auc_data %>% select(-Y),'prob')
TEST.scored <- cbind(auc_data,class,probs) %>% mutate(data = "MODEL1")
model2 <- train(
Y ~ var_19 + var_6 +var_21 + var_1 + var_13 + var_15,
data=sub_data,
method="glm", family="binomial", trControl=ctrl)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
library(yardstick)
?roc_curve
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
head(predictions)
predictions %>%
group_by(model_name) %>%
roc_curve(truth=data$Y, 1) %>%
autoplot()
predictions$`data$Y` <- as.factor(predictions$`data$Y`)
predictions %>%
group_by(model_name) %>%
roc_curve(truth=data$Y, 1) %>%
autoplot()
predictions %>%
group_by(model_name) %>%
roc_curve(truth=data$Y, "1") %>%
autoplot()
source("D:/studies/HDSAssignments/PMIM202/code/preprocessing.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/data_modelling.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
sum(is.na(sub_data1))
sum(is.na(sub_data2))
sum(sub_data2$Y)
sum(sub_data1$Y)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/code/secondary_analysis.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/app.R", echo=TRUE)
source("D:/studies/HDSAssignments/PMIM202/app.R", echo=TRUE)
data_path <- 'data/wales_data/processed_imputed_file.csv'
tmp_data <- read_csv(data_path)
dim(tmp_data[which(tmp_data$var_37 > 25 & tmp_data$Y == 1), ])[1] / 744
data <- convert_to_factors(data, colname_mapping)
data_path <- 'data/wales_data/processed_imputed_file.csv'
tmp_data <- read_csv(data_path)
colname_mapping <- read_csv("data/wales_data/column_name_mapping.csv")
tmp_data <- convert_to_factors(tmp_data, colname_mapping)
names(tmp_data)[35] <- "Y"
dim(tmp_data[which(tmp_data$var_37 > 25 & tmp_data$Y == 1), ])[1] / 744
dim(tmp_data[which(tmp_data$var_37 < 18 & tmp_data$Y == 1), ])[1] / 744
sub_data1 <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8 + var_21 +
var_6*var_25 +
var_25*var_12 +
var_12*var_5 +
var_5*var_8 +
var_8*var_21,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_model(sub_data1)
display_confusion_matrix(sub_data, interaction_model)
summary(interaction_model)
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8 + var_21 +
var_6*var_25 + var_6*var_29 + var_6*var_12 + var_6*var_5 + var_6*var_8 + var_6*var_21 +
var_25*var_29 + var_25*var_12 + var_25*var_5 + var_25*var_8 + var_25*var_21 +
var_29*var_12 +  var_29*var_5 +  var_29*var_8 +  var_29*var_21 +
var_12*var_5 +  var_12*var_8 +  var_12*var_21 +
var_5*var_8 +  var_5*var_21 +
var_8*var_21,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ *,
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ .,
data=data,
method="glmStepAIC", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
print(interaction_model$anova)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_21,
data=data,
method="glmStepAIC", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_292 + var_293 + var_294 + var_296 +
var_297 + var_12 + var_5,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_12
data=data,
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_12,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_12 +
var_6 *var_25 *var_12,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8 + var_21 +
var_6*var_25*var_29*var_12*var_5*var_8*var_21,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
model_summary <- tidy(summary(interaction_model))
library(broom)
model_summary <- broom::tidy(summary(interaction_model))
model_summary <- tidy(summary(interaction_model))
?tidy
model_summary <- broom::tidy.glm(summary(interaction_model))
display_confusion_matrix(sub_data, interaction_model)
preds <- get_predictions(sub_data, interaction_model,
"interaction_model")
preds %>%
group_by(model_name) %>%
roc_curve(truth=`data$Y`, "1") %>%
autoplot()
preds <- get_predictions(sub_data, interaction_model,
"interaction_model")
preds$`data$Y` <- as.factor(preds$`data$Y`)
preds %>%
group_by(model_name) %>%
roc_curve(truth=`data$Y`, "1") %>%
autoplot()
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8 + var_21 +
var_6*var_25*var_29,
data=data,
method="glmStepAIC", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8 + var_21,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8 + var_21 +
I(var_6*var_25)^2,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8 + var_21 +
I(var_6)^2 + I(var_25)^2,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
ctrl <- trainControl(method="cv", number=5)
data$Y <- as.factor(data$Y)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
display_confusion_matrix(sub_data, interaction_model)
preds <- get_predictions(sub_data, interaction_model,
"interaction_model")
preds$`data$Y` <- as.factor(preds$`data$Y`)
preds %>%
group_by(model_name) %>%
roc_curve(truth=`data$Y`, "1") %>%
autoplot()
get_interation_model <- function(data){
data$Y <- as.factor(data$Y)
folds <- 4
cvIndex <- createFolds(factor(data$Y), folds, returnTrain = T)
ctrl <- trainControl(index = cvIndex,
method = 'cv',
number = folds)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
data$Y <- as.factor(data$Y)
folds <- 4
cvIndex <- createFolds(factor(data$Y), folds, returnTrain = T)
ctrl <- trainControl(index = cvIndex,
method = 'cv',
number = folds)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_12 + var_5 + var_8,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
get_interation_model <- function(data){
data$Y <- as.factor(data$Y)
folds <- 4
cvIndex <- createFolds(factor(data$Y), folds, returnTrain = T)
ctrl <- trainControl(index = cvIndex,
method = 'cv',
number = folds)
# interaction 1
model <- train(
Y ~ var_6 + var_25 + var_29 + var_12 + var_5 + var_8,
data=data,
method="glm", family="binomial", trControl=ctrl)
print(model)
return(model)
}
sub_data <- tmp_data %>%
select(var_6, var_25, var_29, var_12, var_5, var_8, var_21, Y)
interaction_model <- get_interation_model(sub_data)
summary(interaction_model)
